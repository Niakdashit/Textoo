javascript:(function(){try{const LS_KEY='HMW_WORKER_URL';let W=localStorage.getItem(LS_KEY)||'';if(!W){W=prompt('URL du Worker (ex: https://…/generate)');if(!W)return;localStorage.setItem(LS_KEY,W);}const css=`#hmw-modal{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:2147483000;display:flex;align-items:center;justify-content:center}#hmw-card{width:min(560px,92vw);background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}#hmw-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}#hmw-body{padding:12px 14px;display:grid;gap:10px}#hmw-body label{font-size:12px;color:#374151}#hmw-body textarea,#hmw-body select{width:100%;box-sizing:border-box;padding:8px;border:1px solid #e5e7eb;border-radius:8px;font:inherit}#hmw-actions{display:flex;gap:8px;justify-content:flex-end}#hmw-actions button{background:#0b57d0;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer}#hmw-out{border:1px solid #e5e7eb;border-radius:8px;padding:8px;display:none}#hmw-out pre{white-space:pre-wrap;max-height:260px;overflow:auto;font-family:ui-monospace,Menlo,Monaco,monospace;font-size:12px}#hmw-err{color:#b91c1c;font-size:12px;display:none}`;const st=document.createElement('style');st.textContent=css;const modal=document.createElement('div');modal.id='hmw-modal';modal.innerHTML=`<div id="hmw-card"><div id="hmw-head"><strong>Help me write</strong><button id="hmw-x" title="Fermer" style="background:transparent;border:none;font-size:16px;cursor:pointer">✖</button></div><div id="hmw-body"><div><label>Style</label><select id="hmw-tone"><option value="direct">Direct</option><option value="poli">Poli / détaillé</option><option value="ferme">Ferme / cadrage</option></select></div><div><label>Signature</label><textarea id="hmw-sign" rows="2">Cordialement,\nJonathan</textarea></div><div><label>Contexte (colle l'email ou points clés)</label><textarea id="hmw-ctx" rows="8"></textarea></div><div id="hmw-actions"><button id="hmw-gen">Proposer</button><button id="hmw-copy">Copier</button></div><div id="hmw-out"><pre id="hmw-text"></pre></div><div id="hmw-err"></div></div></div>`;function close(){modal.remove();st.remove();}modal.querySelector('#hmw-x').onclick=close;document.body.appendChild(st);document.body.appendChild(modal);const btnGen=modal.querySelector('#hmw-gen');const btnCopy=modal.querySelector('#hmw-copy');const ctx=modal.querySelector('#hmw-ctx');const tone=modal.querySelector('#hmw-tone');const sign=modal.querySelector('#hmw-sign');const out=modal.querySelector('#hmw-out');const text=document.getElementById('hmw-text');const err=modal.querySelector('#hmw-err');btnGen.onclick=async()=>{btnGen.disabled=true;btnGen.textContent='Génération…';err.style.display='none';try{const r=await fetch(W,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({context:ctx.value||'',tone:tone.value,signature:sign.value||'Cordialement,\nJonathan'})});if(!r.ok){throw new Error('HTTP '+r.status);}const data=await r.json();text.textContent=(data&&data.text)||'';out.style.display='block';}catch(e){err.textContent='Erreur: '+(e.message||e);err.style.display='block';}finally{btnGen.disabled=false;btnGen.textContent='Proposer';}};btnCopy.onclick=async()=>{try{await navigator.clipboard.writeText(text.textContent||'');btnCopy.textContent='Copié !';setTimeout(()=>btnCopy.textContent='Copier',1200);}catch(e){const s=window.getSelection();const r=document.createRange();r.selectNodeContents(text);s.removeAllRanges();s.addRange(r);document.execCommand('copy');s.removeAllRanges();btnCopy.textContent='Copié !';setTimeout(()=>btnCopy.textContent='Copier',1200);}};}catch(e){alert('Bookmarklet erreur: '+(e.message||e));}})();
